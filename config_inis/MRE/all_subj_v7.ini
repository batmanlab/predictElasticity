[Project]
task = MRE

[Notes]
note = Smart sampling L2 and rand init worker are now assumed default, and clinical set
    3 inputs, clinical, erode 2
    Erode fix in final calc
    Test group by mre
    Norm clinical
    No aug on val
    New input normalization
    Batch Norm
    Stratified sampling on gender, larger val set (20->28), no save till epoch 50
    Tweak to stratification to make test/val splits similar among folds
    Add in some smearing, and subj-level loss weight
    Test size is 4 instead of 8


[Node]
partition = GPU-AI
gpu = volta16
ngpus = 1

[Hyper]
seed = [2]
data_path = '/pghbio/dbmi/batmanlab/Data/MRE/XR_full_gold_clinical_v3/'
data_file = '*.nc'
output_path = '/pghbio/dbmi/batmanlab/bpollack/predictElasticity/data'

num_workers = 4
batch_size = 4

lr_scheduler='step'
gamma=0.3
lr=1e-3
step_size=30
weight_decay=[0]

in_channels=3
inputs = [['t1_pre_water', 't1_pre_fat', 't1_pos_70_water']]


do_clinical = True 
norm_clinical = True 
subj_group = [['1045', '1329', '1714', '1935'],
           ['0509', '1336', '1367', '1839'],
           ['0931', '0937', '1699', '1819'],
           ['0234', '1077', '1341', '1748'],
           ['0210', '0898', '1382', '1967'],
           ['0872', '1033', '1712', '1851'],
           ['0043', '0693', '0995', '1412'],
           ['0734', '0748', '1123', '1404'],
           ['1076', '1435', '1791', '1883'],
           ['0219', '0235', '1121', '1715'],
           ['1736', '1843', '1853', '1980'],
           ['0659', '1400', '1447', '1642'],
           ['0126', '0737', '1829', '1899'],
           ['0860', '1395', '1706', '1785'],
           ['0655', '0704', '1790', '2029'],
           ['1448', '1474', '1574', '1903'],
           ['0135', '0747', '1541', '1948'],
           ['0914', '1530', '1578', '1722'],
           ['0735', '0979', '1550', '2034'],
           ['0628', '1149', '1456', '1765'],
           ['0556', '0929', '1072', '1119'],
           ['0830', '0932', '1271', '1694'],
           ['1667', '1720', '1806', '1979'],
           ['0344', '0401', '1311', '1491'],
           ['0415', '0940', '1360', '1417'],
           ['0291', '0491', '0612', '1217'],
           ['0006', '0510', '1144', '1464'],
           ['0020', '1337', '1561', '1896'],
           ['1083', '1453', '2001', '2046'],
           ['0173', '0461', '1287'],
           ['0954', '1798', '2007'],
           ['0653', '1595', '1671'],
           ['0564', '1103', '1504'],
           ['0029', '1529', '1789'],
           ['0975', '1110', '1577'],
           ['1526', '1603', '1786'],
           ['1793', '1795', '1940'],
           ['0492', '0890', '1679'],
           ['0904', '1106', '1590'],
           ['1554', '1727', '1893']]
#subj_group = [['1550'], ['1839'], ['0126'], ['0890'], ['1899'], ['1456'], ['1851'], ['0415'], ['0937'], ['1829'], ['0173'], ['1083'], ['1561'], ['1795'], ['1033'], ['1123'], ['0659'], ['1504'], ['0932'], ['1417'], ['1491'], ['1798'], ['0693'], ['0029'], ['1748'], ['1287'], ['2034'], ['0655'], ['0954'], ['1103'], ['0491'], ['1603'], ['1843'], ['1791'], ['0975'], ['1311'], ['1948'], ['1367'], ['1979'], ['1727'], ['0401'], ['1667'], ['0735'], ['1453'], ['0006'], ['0734'], ['0898'], ['1793'], ['0612'], ['1940'], ['1699'], ['1883'], ['1526'], ['0461'], ['0747'], ['1595'], ['1578'], ['1893'], ['1474'], ['0210'], ['1574'], ['1736'], ['0737'], ['1400'], ['0628'], ['1106'], ['0509'], ['1722'], ['1530'], ['1896'], ['0556'], ['1435'], ['1149'], ['1554'], ['1790'], ['0020'], ['1110'], ['0564'], ['1980'], ['1786'], ['0291'], ['1144'], ['0872'], ['0931'], ['0344'], ['1715'], ['1590'], ['0704'], ['0830'], ['2007'], ['1765'], ['1217'], ['1819'], ['1119'], ['1395'], ['2029'], ['0510'], ['1642'], ['2046'], ['1714'], ['0235'], ['1789'], ['0929'], ['1045'], ['1447'], ['1935'], ['1541'], ['1853'], ['1072'], ['1412'], ['0043'], ['1720'], ['1077'], ['1448'], ['1329'], ['1903'], ['1464'], ['1967'], ['1360'], ['0979'], ['1337'], ['1529'], ['1341'], ['1336'], ['1121'], ['0860'], ['1706'], ['0914'], ['1679'], ['1076'], ['1712'], ['0135'], ['1671'], ['0904'], ['1785'], ['1806'], ['0748'], ['1271'], ['0995'], ['2001'], ['1577'], ['0234'], ['1694'], ['1404'], ['0940'], ['0653'], ['1382'], ['0492'], ['0219']]
# subj_group = [['0029', '0291', '0491', '0556', '0653', '0734', '0904', '0995', '1083', '1287', '1329', '1448', '1550', '1574', '1899'],
#     ['0020', '0415', '0737', '0975', '1149', '1217', '1435', '1464', '1736', '1785', '1790', '1791', '1798', '1940', '2034'],
#     ['0401', '0898', '1103', '1367', '1456', '1530', '1561', '1577', '1679', '1694', '1714', '1748', '1795', '1806', '1843'],
#     ['0006', '0173', '0509', '0628', '0735', '0748', '0979', '1106', '1271', '1360', '1417', '1474', '1504', '1590', '1786'],
#     ['0043', '0219', '0234', '0492', '0914', '0954', '1123', '1395', '1529', '1541', '1671', '1699', '1706', '1722', '2046'],
#     ['0210', '0830', '0929', '0940', '1119', '1603', '1712', '1765', '1853', '1893', '1903', '1948', '1967', '1979', '2007'],
#     ['0612', '0659', '0704', '0872', '0931', '0932', '1033', '1072', '1144', '1400', '1453', '1642', '1667', '1715', '2001'],
#     ['0461', '0747', '0937', '1045', '1121', '1311', '1404', '1447', '1554', '1720', '1727', '1789', '1829', '1839', '1896'],
#     ['0235', '0344', '0510', '0655', '0890', '1076', '1077', '1110', '1336', '1341', '1382', '1412', '1491', '1526', '1980'],
#     ['0126', '0135', '0564', '0693', '0860', '1337', '1578', '1595', '1793', '1819', '1851', '1883', '1935', '2029']]
# subj_group = [['0415', '0491', '0735', '0914', '1119', '1590', '1706', '1940'],
#            ['0860', '1404', '1464', '1504', '1561', '1899', '2007'],
#            ['0748', '0929', '1336', '1554', '1671', '1748', '1790'],
#            ['0492', '0556', '1103', '1382', '1412', '1435', '1491', '1765'],
#            ['0461', '0937', '0995', '1033', '1287', '1311', '1529', '1798'],
#            ['0210', '1045', '1271', '1395', '1786', '1829', '1843'],
#            ['0173', '0344', '0510', '0954', '1077', '1893', '2029'],
#            ['0126', '0890', '0898', '0931', '1329', '1578', '1806', '1883'],
#            ['0655', '1072', '1123', '1722', '1727', '1789', '1795'],
#            ['1603', '1679', '1699', '1791', '1839', '1851', '1853'],
#            ['0509', '1121', '1360', '1448', '1526', '1541', '1574', '1712'],
#            ['0612', '0659', '0872', '0975', '1083', '1400', '1577', '1667'],
#            ['0020', '0704', '0940', '1144', '1337', '1456', '1903', '1967'],
#            ['0564', '0628', '0737', '1447', '1474', '1720', '2034'],
#            ['0006', '0234', '0979', '1417', '1595', '1896', '1935'],
#            ['0029', '0291', '0747', '0904', '1785', '1979', '2046'],
#            ['0135', '0734', '0932', '1110', '1453', '1793', '2001'],
#            ['0653', '0830', '1076', '1550', '1642', '1736', '1948'],
#            ['0219', '0693', '1149', '1217', '1367', '1530', '1714', '1980'],
#            ['0043', '0235', '0401', '1106', '1341', '1694', '1715', '1819']]
# subj_group = [['a'],
#            ['a'],
#            ['a'],
#            ['a'],
#            ['a'],
#            ['a'],
#            ['a'],
#            ['a'],
#            ['a'],
#            ['a'],
#            ['a'],
#            ['a'],
#            ['a'],
#            ['0135', '0747', '1417', '1448', '1595', '1603', '1791', '1899'],]
#            ['a'],
#            ['a'],
#            ['a'],
#            ['1287', '1839', '0219', '0979', '0860', '1603', '0564', '1072'],
#            ['a'],
#            ['a']]

model_arch = 'deeplab'

pixel_weight = 0.5
loss = 'l2'
out_channels_final = 1

sampling_breakdown = 'stratified'
# sampling_breakdown = 'stratified_fixed'
# sampling_breakdown = 'smart_LOO'
# sampling_breakdown = 'smart'
worker_init_fn = 'rand_epoch'

erode_mask = [2]
smear_amt = [25]
train_aug = True
train_smear = ['aniso']
train_sample = 'shuffle'
val_aug = False 
val_smear = ['none']
val_sample = 'shuffle'
norm = ['bn']
dims=3

num_epochs = 120
